## 图解http笔记

### HTTP方法

表格为全部方法，下方介绍为常用方法

| 方法 | 说明 | 支持的HTTP协议版本 |
| --- | --- | --- |
| GET | 获取资源 | 1.0、1.1 |
| POST | 传输实体主体 | 1.0、1.1 |
| PUT | 传输文件 | 1.0、1.1 |
| HEAD | 获得报文首部 | 1.0、1.1 |
| DELETE | 删除文件 | 1.0、1.1 |
| OPTIONS | 询问支持的方法 | 1.1 |
| TRACE | 追踪路径 | 1.1 |
| CONNECT | 要求用隧道协议连接代理 | 1.1 |
| LINK | 建立和资源之间的联系 | 1.0 |
| UNLINE | 断开连接关系 | 1.0 |

1. GET：获取资源
   GET方法用来请求访问已被URI识别的资源
2. POST：传输实体主体
   用来传输实体主体，虽然GET方法也可以传输实体的主体，但一般不用GET方法进行传输
3. PUT：传输文件
   PUT方法用来传输文件，但存在安全性问题，若要配合web应用程序的验证机制，或架构设计采用REST标准的同类web网站，就可能会开放使用PUT方法
4. HEAD：获得报文首部
   和GET方法一样，只是不返回报文主体部分。用于确认URI的有效性及资源更新的日期时间等
5. OPTIONS：询问支持的方法
   OPTIONS方法用来查询针对请求URI指定的资源支持的方法
6. DELETE：删除文件
   与PUT相反的方法，DELETE方法按请求URI删除指定的资源，与PUT方法一样不存在验证机制，所以一般的web网站也不使用DELETE方法，若要配合web应用程序的验证机制，或架构设计采用REST标准的同类web网站，就可能会开放使用
7. TRACE：追踪路径
   让web服务器将之前的请求通信环回给客户端的方法
   在`Max-Forwards`首部字段中填入数值，每经过一个服务器端，就将该数字减1，当数值刚好减到0时，就停止继续传输，最后接收到请求的服务器端则返回状态码200OK的响应
   通过此方法可以查询发送出去的请求是怎样被加工修改 / 篡改的
   此方法不常用，而且容易引起XST(Cross-Site Tracing, 跨站追踪)攻击
8. CONNECT：要求用隧道协议连接代理
   此方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL和TLS协议把通信内容加密后经网络隧道传输

---

### HTTP状态码

##### **状态码类别**

| 状态码 | 类别 | 原因短语 |
| --- | --- | --- |
| 1XX | Informational 信息性状态码 | 接收的请求正在处理 |
| 2XX | Success 成功状态码 | 请求正常处理完毕 |
| 3XX | Redirection 重定向状态码 | 需要进行附加操作以完成请求 |
| 4XX | Client Error 客户端错误状态码 | 服务器无法处理请求 |
| 5XX | Server Error 服务器错误状态码 | 服务器处理请求出错 |

##### **常用的14个状态码**

1. **200**  OK 请求成功
2. **204** No Content 服务器成功处理，但在返回的响应报文中不含实体的主体部分
3. **206** Partial Content 表示客户端进行了范围请求，而服务器成功执行了这部分的GET请求。响应报文中包含由 Content-Range指定范围的实体内容
4. **301** Moved Permanently 永久重定向，表示请求的资源已被分配了新的URI，所以应使用资源现在所指的URI
5. **302** Found 临时重定向 表示请求的资源已被分配了新的URI，希望用户本次能使用新的URI访问
6. **303** See Other 表示由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源。303与302的不同之处在于303状态码明确表示客户端应当采用GET方法获取资源
7. **304** Not Modified 该状态码和重定向没有关系，该状态码表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但未满足条件的情况，返回时，不包含任何响应的主体部分
8. **307** Temporary Redirect， 302标准禁止POST变换成GET，但实际使用时大家并不遵守，307会遵照浏览器标准，不会从POST变成GET
9. **400** Bad Request 请求报文中存在语法错误
10. **401** Unauthorized 发送的请求需要有通过HTTP认证的认证信息，若之前已进行过一次请求，则表示用户认证失败
11. **403** Forbidden 请求资源的访问被服务器拒绝了，服务器可给出拒绝的详细理由，也可不给出
12. **404** Not Found 无法找到请求的资源，也可在服务器端拒绝请求且不想说明理由时使用
13. **500** Internal Server Error 服务器执行请求时发生了错误，也可能是web引用存在的bug或某些临时的故障
14. **503** Service Unavailable 无法处理请求

**补充：当301、302、303状态码返回时，几乎所有的浏览器都会把POST改为GET，并删除请求报文内的主体，之后请求会自动再次发送。301、302标准是禁止将POST方法改编成GET的，但实际使用时大家都会这么做**

**补充：状态码有时候会和状况不一致，比如web应用程序内部发生错误，但状态码依旧返回200 OK**

### 与HTTP协作的web服务器

##### 代理服务器

每经过一台代理服务器，都会添加via首部字段信息，以标记出经过的主机信息，扮演中间人的角色

代理有多种使用方法，按两种基准分类

1. 是否使用缓存
   代理转发响应时，缓存代理会预先将资源的副本缓存在代理服务器上
   当代理再次接收到相同资源的请求时，就可以将缓存的资源作为响应返回，而不用从源服务器那里获取资源
2. 是否会修改报文
   转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理。反之，对报文内容进行加工的代理被称为非透明代理

##### 网关

网关是转发其他服务器通信数据的服务器，工作机制和代理十分相似，而网关能使通信线路上的服务器提供非HTTP协议服务，利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保连接的安全

##### 隧道

隧道是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。隧道可按要求建立起一条与其他服务器的通信线路，届时使用SSL等加密手段进行通信，目的是确保进行安全的通信

隧道本身不会去解析HTTP请求

通信双方断开连接时结束

##### 保存资源的缓存

1. 避免多次从源服务器转发资源，因此客户端可就近从缓存服务器上获取资源
2. 即使存在缓存，也会因为客户端的要求、缓存的有效期等因素，向服务器确认资源的有效性。若判断缓存失效，缓存服务器将再次从源服务器上获取新资源
3. 客户端的缓存，浏览器缓存如果有效，就不必再向服务器请求相同的资源了，可以直接从本地磁盘读取，若判断浏览器缓存失效，浏览器会再次请求新资源

---

### HTTP首部

http协议的请求和响应报文中必定包含http首部,首部内容为客户端和服务器分别处理请求和响应提供所需要的信息

##### 请求报文

在请求中，http报文由方法、URI、HTTP版本、HTTP首部字段等部分构成，HTTP首部字段又包含了请求首部字段、通用首部字段、实体首部字段

##### 响应报文

在响应中，HTTP报文由HTTP版本、状态码（数字和原因短语）、HTTP首部字段3部分构成

##### 4种http首部字段类型

1. 通用首部字段 General Header Fields 请求报文和响应报文两方都会使用的首部
2. 请求首部字段 Request Header Fields 从客户端向服务器端发送请求报文时使用的首部。补充了请求的附加内容、客户端信息、响应内容相关优先级等信息
3. 响应首部字段 Response Header Fields 从服务器端向客户端返回响应报文时使用的首部。补充了响应的附加内容，也会要求客户端附加额外的内容信息
4. 实体首部字段 Entity Header Fields 针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等与实体相关的信息

##### End-to-end 首部和Hop-by-hop首部

HTTP首部字段将定义成缓存代理和非缓存代理的行为，分成两种类型

**端到端首部 End-to-end Header**
分在此类别种的首部会转发给请求 / 响应对应的最终接收目标，且必须保存在由缓存生成的响应种，另外规定它必须被转发

**逐跳首部**
分在此类别种的首部只对单词转发有效，会因通过缓存或代理而不再转发。HTTP/1.1和之后的版本中，如果要使用hop-by-hop首部，需提供Connection首部字段

- Connection
- Keep-Alive
- Proxy-Authenticate
- Proxy-Authorization
- Trailer
- TE
- Transfer-Encoding
- Upgrade

除了以上8个首部字段外，其余所有字段都属于端到端首部

##### HTTP通用首部字段
